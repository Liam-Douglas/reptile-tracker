{% extends "base.html" %}

{% block title %}Purchase Receipts{% endblock %}

{% block content %}
<div class="page-header" style="margin-bottom: 1.5rem;">
    <h1 class="page-title">
        <i class="fas fa-receipt"></i> Purchase Receipts
    </h1>
    <div style="display: flex; gap: 1rem;">
        <a href="{{ url_for('add_purchase_receipt') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Receipt
        </a>
        <a href="{{ url_for('food_inventory') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Inventory
        </a>
    </div>
</div>

{% if receipts %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Receipt History</h3>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: var(--text-secondary); font-weight: normal;">
            {{ receipts|length }} receipt{{ 's' if receipts|length != 1 else '' }} on record
        </p>
    </div>
    
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Supplier</th>
                    <th>Items</th>
                    <th>Total Cost</th>
                    <th>Payment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for receipt in receipts %}
                <tr>
                    <td>
                        <strong>{{ receipt.receipt_date|format_date }}</strong>
                    </td>
                    <td>
                        {% if receipt.supplier %}
                            <i class="fas fa-store" style="color: var(--text-secondary); margin-right: 0.25rem;"></i>
                            {{ receipt.supplier }}
                        {% else %}
                            <span style="color: var(--text-secondary); font-style: italic;">Not specified</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge" style="background: var(--primary-color); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">
                            {{ receipt.item_count }} item{{ 's' if receipt.item_count != 1 else '' }}
                        </span>
                    </td>
                    <td>
                        {% if receipt.total_cost %}
                            <strong style="color: var(--primary-color);">${{ "%.2f"|format(receipt.total_cost) }}</strong>
                        {% else %}
                            <span style="color: var(--text-secondary);">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if receipt.payment_method %}
                            <span style="font-size: 0.875rem;">{{ receipt.payment_method }}</span>
                        {% else %}
                            <span style="color: var(--text-secondary); font-style: italic;">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('view_purchase_receipt', receipt_id=receipt.id) }}" 
                               class="btn btn-sm btn-primary"
                               title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            <form method="POST" 
                                  action="{{ url_for('delete_purchase_receipt', receipt_id=receipt.id) }}" 
                                  style="display: inline;"
                                  onsubmit="return confirm('Are you sure you want to delete this receipt? This will NOT remove items from inventory.');">
                                <button type="submit" 
                                        class="btn btn-sm btn-danger"
                                        title="Delete Receipt">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Summary Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
    <div class="card" style="margin: 0;">
        <div style="padding: 1.5rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color); margin-bottom: 0.5rem;">
                {{ receipts|length }}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
                Total Receipts
            </div>
        </div>
    </div>
    
    <div class="card" style="margin: 0;">
        <div style="padding: 1.5rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--success-color); margin-bottom: 0.5rem;">
                ${{ "%.2f"|format(total_spent) }}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
                Total Spent
            </div>
        </div>
    </div>
    
    <div class="card" style="margin: 0;">
        <div style="padding: 1.5rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--info-color); margin-bottom: 0.5rem;">
                {{ total_items }}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
                Total Items Purchased
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- Empty State -->
<div class="card">
    <div style="padding: 3rem; text-align: center;">
        <div style="font-size: 4rem; color: var(--text-secondary); margin-bottom: 1rem;">
            <i class="fas fa-receipt"></i>
        </div>
        <h3 style="margin-bottom: 1rem; color: var(--text-secondary);">No Receipts Yet</h3>
        <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
            Start tracking your food purchases by adding your first receipt. This helps you monitor spending and automatically updates your inventory.
        </p>
        <a href="{{ url_for('add_purchase_receipt') }}" class="btn btn-primary" style="padding: 0.75rem 2rem;">
            <i class="fas fa-plus"></i> Add Your First Receipt
        </a>
    </div>
</div>
{% endif %}

<style>
.btn-sm {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .data-table {
        font-size: 0.875rem;
    }
    
    .data-table th,
    .data-table td {
        padding: 0.5rem;
    }
}
</style>
{% endblock %}