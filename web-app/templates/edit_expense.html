{% extends "base.html" %}

{% block title %}Edit Expense{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-edit"></i> Edit Expense
    </h1>
    <a href="{{ url_for('expense_details', expense_id=expense.id) }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Details
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Expense Details</h3>
    </div>
    <div style="padding: 2rem;">
        <form method="POST" action="{{ url_for('edit_expense', expense_id=expense.id) }}" enctype="multipart/form-data">
            <div style="display: grid; gap: 1.5rem;">
                <!-- Date and Category Row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="expense_date" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Date <span style="color: #ef4444;">*</span>
                        </label>
                        <input type="date" 
                               name="expense_date" 
                               id="expense_date" 
                               required
                               value="{{ expense.expense_date }}"
                               style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                    </div>
                    
                    <div>
                        <label for="category" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Category <span style="color: #ef4444;">*</span>
                        </label>
                        <select name="category" 
                                id="category" 
                                required
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                            <option value="">Select Category</option>
                            {% for cat in categories %}
                            <option value="{{ cat }}" {% if expense.category == cat %}selected{% endif %}>
                                {{ cat }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <!-- Amount and Currency Row -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                    <div>
                        <label for="amount" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Amount <span style="color: #ef4444;">*</span>
                        </label>
                        <input type="number" 
                               name="amount" 
                               id="amount" 
                               step="0.01" 
                               min="0" 
                               required
                               value="{{ expense.amount }}"
                               placeholder="0.00"
                               style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                    </div>
                    
                    <div>
                        <label for="currency" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Currency
                        </label>
                        <select name="currency" 
                                id="currency"
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                            <option value="USD" {% if expense.currency == 'USD' %}selected{% endif %}>USD</option>
                            <option value="EUR" {% if expense.currency == 'EUR' %}selected{% endif %}>EUR</option>
                            <option value="GBP" {% if expense.currency == 'GBP' %}selected{% endif %}>GBP</option>
                            <option value="AUD" {% if expense.currency == 'AUD' %}selected{% endif %}>AUD</option>
                            <option value="CAD" {% if expense.currency == 'CAD' %}selected{% endif %}>CAD</option>
                        </select>
                    </div>
                </div>
                
                <!-- Reptile Selection -->
                <div>
                    <label for="reptile_id" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Reptile (Optional)
                    </label>
                    <select name="reptile_id" 
                            id="reptile_id"
                            style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                        <option value="">General Expense (Not specific to a reptile)</option>
                        {% for reptile in reptiles %}
                        <option value="{{ reptile.id }}" {% if expense.reptile_id == reptile.id %}selected{% endif %}>
                            {{ reptile.name }} ({{ reptile.species }})
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Vendor and Payment Method Row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="vendor" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Vendor/Store
                        </label>
                        <input type="text" 
                               name="vendor" 
                               id="vendor"
                               value="{{ expense.vendor or '' }}"
                               placeholder="e.g., PetSmart, Amazon"
                               style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                    </div>
                    
                    <div>
                        <label for="payment_method" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Payment Method
                        </label>
                        <select name="payment_method" 
                                id="payment_method"
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                            <option value="">Select Method</option>
                            <option value="Cash" {% if expense.payment_method == 'Cash' %}selected{% endif %}>Cash</option>
                            <option value="Credit Card" {% if expense.payment_method == 'Credit Card' %}selected{% endif %}>Credit Card</option>
                            <option value="Debit Card" {% if expense.payment_method == 'Debit Card' %}selected{% endif %}>Debit Card</option>
                            <option value="PayPal" {% if expense.payment_method == 'PayPal' %}selected{% endif %}>PayPal</option>
                            <option value="Bank Transfer" {% if expense.payment_method == 'Bank Transfer' %}selected{% endif %}>Bank Transfer</option>
                            <option value="Other" {% if expense.payment_method == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                </div>
                
                <!-- Description -->
                <div>
                    <label for="description" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Description
                    </label>
                    <input type="text" 
                           name="description" 
                           id="description"
                           value="{{ expense.description or '' }}"
                           placeholder="Brief description of the expense"
                           style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                </div>
                
                <!-- Current Receipt -->
                {% if expense.receipt_path %}
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Current Receipt
                    </label>
                    <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 4px; display: flex; align-items: center; gap: 1rem;">
                        <i class="fas fa-file-invoice" style="font-size: 2rem; color: var(--primary-color);"></i>
                        <div style="flex: 1;">
                            <a href="{{ url_for('static', filename='../uploads/' + expense.receipt_path) }}" 
                               target="_blank"
                               style="color: var(--primary-color); text-decoration: none; font-weight: 500;">
                                View Current Receipt
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Receipt Upload -->
                <div>
                    <label for="receipt" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        {% if expense.receipt_path %}Replace Receipt{% else %}Add Receipt{% endif %}
                    </label>
                    <input type="file" 
                           name="receipt" 
                           id="receipt" 
                           accept=".png,.jpg,.jpeg,.pdf"
                           style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                    <small style="color: var(--text-secondary); display: block; margin-top: 0.25rem;">
                        PNG, JPG, or PDF (max 10MB) - Leave empty to keep current receipt
                    </small>
                </div>
                
                <!-- Tags -->
                <div>
                    <label for="tags" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Tags
                    </label>
                    <input type="text" 
                           name="tags" 
                           id="tags"
                           value="{{ expense.tags or '' }}"
                           placeholder="e.g., monthly, urgent, bulk-purchase (comma-separated)"
                           style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary);">
                </div>
                
                <!-- Recurring Expense -->
                <div>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" 
                               name="is_recurring" 
                               id="is_recurring"
                               value="1"
                               {% if expense.is_recurring %}checked{% endif %}
                               style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-weight: 500;">This is a recurring expense</span>
                    </label>
                </div>
                
                <!-- Notes -->
                <div>
                    <label for="notes" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Notes
                    </label>
                    <textarea name="notes" 
                              id="notes" 
                              rows="4"
                              placeholder="Additional notes or details about this expense"
                              style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); resize: vertical;">{{ expense.notes or '' }}</textarea>
                </div>
                
                <!-- Submit Buttons -->
                <div style="display: flex; gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Update Expense
                    </button>
                    <a href="{{ url_for('expense_details', expense_id=expense.id) }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
@media (max-width: 768px) {
    div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}